# Tracing

<!--introduced_in=v7.7.0-->

Trace Event provides a mechanism to centralize tracing information generated by
V8, Node.js core, and userspace code.

Tracing can be enabled either by using the `--trace-event-categories` flag
followed by a list of comma separated category names, or by using the
`trace_events.setTracingCategories()` method.

The available categories are:

* `node`
* `node.async_hooks` - Enables capture of detailed async_hooks trace data.
* `node.bootstrap` - Enables capture of Node.js bootstrap milestones.
* `node.perf` - Enables capture of [Performance API] measurements.
  * `node.perf.usertiming` - Enables capture of only Performance API User Timing
    measures and marks.
  * `node.perf.timerify` - Enables capture of only Performance API timerify
    measurements.
* `v8`

```txt
node --trace-event-categories v8,node,node.async_hooks server.js
```

```js
const trace_events = require('trace_events');
trace_events.enableTracingCategories('v8', 'node,node.async_hooks');
```

Running Node.js with tracing enabled will produce log files that can be opened
in the [`chrome://tracing`][] tab of Chrome.

The logging file is by default called `node_trace.${rotation}.log`, where
`${rotation}` is an incrementing log-rotation id. The filepath pattern can
be specified with `--trace-event-file-pattern` that accepts a template
string that supports `${rotation}` and `${pid}`. For example:

```txt
node --trace-event-file-pattern '${pid}-${rotation}.log' server.js
```

Starting with Node.js 10.0.0, the tracing system uses the same time source
as the one used by `process.hrtime()`
however the trace-event timestamps are expressed in microseconds,
unlike `process.hrtime()` which returns nanoseconds.

Previous versions of Node.js required use of the `--trace-events-enabled`
command line flag to enable trace event capture. This flag is no longer
required to enable trace events. If it is used, however, trace events are
enabled using the default categories: `v8`, `node`, and `node.async_hooks`.

## The `trace_events` module

The `trace_events` module may be used to turn trace event reporting on and off.

It is accessible using `require('trace_events')`.

### trace_events.disableTracingCategories(...categories)

* `...categories` {string} One or more category names.

Disables trace event capture for the given set of category names.

An error will be thrown if trace event support is not enabled in the Node.js
binary.

```js
const trace_events = require('trace_events');
trace_events.disableTracingCategories('v8', 'node.async_hooks');
```

To disable all currently enabled trace event categories, the
`trace_events.getTracingCategories()` method may be used together with
`trace_events.disableTracingCategories()`:

```js
const trace_events = require('trace_events');
trace_events.disableTracingCategories(
  ...trace_events.getTracingCategories());
```

### trace_events.enableTracingCategories(...categories)

* `...categories` {string} One or more category names.

Enables trace event capture for the given set of category names.

An error will be thrown if trace event support is not enabled in the Node.js
binary.

```js
const trace_events = require('trace_events');
trace_events.enableTracingCategories('v8', 'node.async_hooks');
```

### trace_events.getTracingCategories()

* Returns: {string[]}

Returns an Array of the currently enabled trace event categories.

```js
const trace_events = require('trace_events');
console.log(trace_events.getTracingCategories());
```

[`chrome://tracing`]: https://www.chromium.org/developers/how-tos/trace-event-profiling-tool
[Performance API]: perf_hooks.html
