'use strict';var cov_iomb9fg5i=function(){var path='internal/repl.js',hash='49278943b83ede8e151f5e7b09d497066089d312',global=new Function('return this')(),gcv='__coverage__',coverageData={path:'internal/repl.js',statementMap:{'0':{start:{line:3,column:18},end:{line:3,column:47}},'1':{start:{line:4,column:13},end:{line:4,column:28}},'2':{start:{line:5,column:13},end:{line:5,column:28}},'3':{start:{line:6,column:11},end:{line:6,column:24}},'4':{start:{line:7,column:11},end:{line:7,column:24}},'5':{start:{line:8,column:13},end:{line:8,column:28}},'6':{start:{line:9,column:14},end:{line:9,column:35}},'7':{start:{line:10,column:0},end:{line:10,column:37}},'8':{start:{line:11,column:0},end:{line:11,column:47}},'9':{start:{line:15,column:27},end:{line:15,column:29}},'10':{start:{line:18,column:2},end:{line:18,column:31}},'11':{start:{line:19,column:2},end:{line:19,column:22}},'12':{start:{line:23,column:2},end:{line:26,column:3}},'13':{start:{line:24,column:4},end:{line:24,column:14}},'14':{start:{line:25,column:4},end:{line:25,column:16}},'15':{start:{line:27,column:2},end:{line:32,column:11}},'16':{start:{line:34,column:2},end:{line:36,column:3}},'17':{start:{line:35,column:4},end:{line:35,column:26}},'18':{start:{line:40,column:2},end:{line:42,column:3}},'19':{start:{line:41,column:4},end:{line:41,column:27}},'20':{start:{line:44,column:2},end:{line:47,column:53}},'21':{start:{line:49,column:2},end:{line:51,column:3}},'22':{start:{line:50,column:4},end:{line:50,column:42}},'23':{start:{line:53,column:22},end:{line:53,column:56}},'24':{start:{line:54,column:2},end:{line:60,column:3}},'25':{start:{line:55,column:4},end:{line:55,column:35}},'26':{start:{line:59,column:4},end:{line:59,column:28}},'27':{start:{line:62,column:15},end:{line:62,column:31}},'28':{start:{line:63,column:2},end:{line:66,column:3}},'29':{start:{line:64,column:4},end:{line:65,column:56}},'30':{start:{line:68,column:2},end:{line:68,column:42}},'31':{start:{line:69,column:2},end:{line:69,column:17}},'32':{start:{line:75,column:2},end:{line:76,column:37}},'33':{start:{line:76,column:4},end:{line:76,column:37}},'34':{start:{line:78,column:2},end:{line:81,column:3}},'35':{start:{line:79,column:4},end:{line:79,column:44}},'36':{start:{line:80,column:4},end:{line:80,column:29}},'37':{start:{line:83,column:2},end:{line:94,column:3}},'38':{start:{line:84,column:4},end:{line:93,column:5}},'39':{start:{line:85,column:6},end:{line:85,column:66}},'40':{start:{line:87,column:6},end:{line:88,column:70}},'41':{start:{line:90,column:6},end:{line:90,column:23}},'42':{start:{line:91,column:6},end:{line:91,column:46}},'43':{start:{line:92,column:6},end:{line:92,column:31}},'44':{start:{line:96,column:14},end:{line:96,column:18}},'45':{start:{line:97,column:16},end:{line:97,column:21}},'46':{start:{line:98,column:16},end:{line:98,column:21}},'47':{start:{line:99,column:2},end:{line:99,column:15}},'48':{start:{line:103,column:2},end:{line:103,column:45}},'49':{start:{line:106,column:4},end:{line:116,column:5}},'50':{start:{line:109,column:6},end:{line:110,column:76}},'51':{start:{line:111,column:6},end:{line:111,column:23}},'52':{start:{line:113,column:6},end:{line:113,column:46}},'53':{start:{line:114,column:6},end:{line:114,column:20}},'54':{start:{line:115,column:6},end:{line:115,column:31}},'55':{start:{line:117,column:4},end:{line:117,column:27}},'56':{start:{line:121,column:4},end:{line:123,column:5}},'57':{start:{line:122,column:6},end:{line:122,column:24}},'58':{start:{line:124,column:4},end:{line:124,column:45}},'59':{start:{line:128,column:4},end:{line:130,column:5}},'60':{start:{line:129,column:6},end:{line:129,column:24}},'61':{start:{line:132,column:4},end:{line:178,column:5}},'62':{start:{line:133,column:6},end:{line:133,column:61}},'63':{start:{line:134,column:11},end:{line:178,column:5}},'64':{start:{line:137,column:6},end:{line:140,column:79}},'65':{start:{line:142,column:11},end:{line:178,column:5}},'66':{start:{line:143,column:18},end:{line:143,column:23}},'67':{start:{line:144,column:6},end:{line:168,column:7}},'68':{start:{line:147,column:35},end:{line:147,column:74}},'69':{start:{line:150,column:8},end:{line:150,column:78}},'70':{start:{line:150,column:32},end:{line:150,column:78}},'71':{start:{line:152,column:8},end:{line:160,column:9}},'72':{start:{line:153,column:10},end:{line:153,column:65}},'73':{start:{line:155,column:10},end:{line:155,column:23}},'74':{start:{line:156,column:10},end:{line:159,column:63}},'75':{start:{line:164,column:8},end:{line:164,column:21}},'76':{start:{line:165,column:21},end:{line:165,column:66}},'77':{start:{line:166,column:8},end:{line:167,column:77}},'78':{start:{line:169,column:6},end:{line:177,column:7}},'79':{start:{line:171,column:8},end:{line:174,column:75}},'80':{start:{line:176,column:8},end:{line:176,column:26}},'81':{start:{line:180,column:4},end:{line:180,column:41}},'82':{start:{line:184,column:4},end:{line:186,column:5}},'83':{start:{line:185,column:6},end:{line:185,column:24}},'84':{start:{line:187,column:4},end:{line:197,column:7}},'85':{start:{line:188,column:6},end:{line:188,column:32}},'86':{start:{line:189,column:6},end:{line:189,column:30}},'87':{start:{line:192,column:6},end:{line:195,column:9}},'88':{start:{line:193,column:8},end:{line:193,column:22}},'89':{start:{line:194,column:8},end:{line:194,column:26}},'90':{start:{line:196,column:6},end:{line:196,column:21}},'91':{start:{line:202,column:4},end:{line:202,column:26}},'92':{start:{line:204,column:4},end:{line:206,column:5}},'93':{start:{line:205,column:6},end:{line:205,column:26}},'94':{start:{line:208,column:4},end:{line:208,column:57}},'95':{start:{line:212,column:4},end:{line:212,column:17}},'96':{start:{line:213,column:4},end:{line:216,column:5}},'97':{start:{line:214,column:6},end:{line:214,column:21}},'98':{start:{line:215,column:6},end:{line:215,column:13}},'99':{start:{line:217,column:4},end:{line:217,column:19}},'100':{start:{line:218,column:24},end:{line:218,column:49}},'101':{start:{line:219,column:4},end:{line:219,column:69}},'102':{start:{line:223,column:4},end:{line:223,column:20}},'103':{start:{line:224,column:4},end:{line:232,column:5}},'104':{start:{line:225,column:6},end:{line:225,column:22}},'105':{start:{line:226,column:6},end:{line:226,column:15}},'106':{start:{line:228,column:6},end:{line:228,column:38}},'107':{start:{line:229,column:6},end:{line:231,column:7}},'108':{start:{line:230,column:8},end:{line:230,column:34}},'109':{start:{line:238,column:2},end:{line:245,column:3}},'110':{start:{line:239,column:4},end:{line:244,column:6}},'111':{start:{line:246,column:2},end:{line:246,column:55}},'112':{start:{line:247,column:2},end:{line:247,column:29}}},fnMap:{'0':{name:'_writeToOutput',decl:{start:{line:17,column:9},end:{line:17,column:23}},loc:{start:{line:17,column:39},end:{line:20,column:1}},line:17},'1':{name:'createRepl',decl:{start:{line:22,column:9},end:{line:22,column:19}},loc:{start:{line:22,column:35},end:{line:70,column:1}},line:22},'2':{name:'setupHistory',decl:{start:{line:72,column:9},end:{line:72,column:21}},loc:{start:{line:72,column:64},end:{line:234,column:1}},line:72},'3':{name:'oninit',decl:{start:{line:105,column:11},end:{line:105,column:17}},loc:{start:{line:105,column:28},end:{line:118,column:3}},line:105},'4':{name:'onclose',decl:{start:{line:120,column:11},end:{line:120,column:18}},loc:{start:{line:120,column:24},end:{line:125,column:3}},line:120},'5':{name:'onread',decl:{start:{line:127,column:11},end:{line:127,column:17}},loc:{start:{line:127,column:29},end:{line:181,column:3}},line:127},'6':{name:'onhandle',decl:{start:{line:183,column:11},end:{line:183,column:19}},loc:{start:{line:183,column:30},end:{line:198,column:3}},line:183},'7':{name:'(anonymous_7)',decl:{start:{line:187,column:25},end:{line:187,column:26}},loc:{start:{line:187,column:34},end:{line:197,column:5}},line:187},'8':{name:'(anonymous_8)',decl:{start:{line:192,column:32},end:{line:192,column:33}},loc:{start:{line:192,column:43},end:{line:195,column:7}},line:192},'9':{name:'online',decl:{start:{line:201,column:11},end:{line:201,column:17}},loc:{start:{line:201,column:20},end:{line:209,column:3}},line:201},'10':{name:'flushHistory',decl:{start:{line:211,column:11},end:{line:211,column:23}},loc:{start:{line:211,column:26},end:{line:220,column:3}},line:211},'11':{name:'onwritten',decl:{start:{line:222,column:11},end:{line:222,column:20}},loc:{start:{line:222,column:32},end:{line:233,column:3}},line:222},'12':{name:'_replHistoryMessage',decl:{start:{line:237,column:9},end:{line:237,column:28}},loc:{start:{line:237,column:31},end:{line:248,column:1}},line:237}},branchMap:{'0':{loc:{start:{line:23,column:2},end:{line:26,column:3}},type:'if',locations:[{start:{line:23,column:2},end:{line:26,column:3}},{start:{line:23,column:2},end:{line:26,column:3}}],line:23},'1':{loc:{start:{line:34,column:2},end:{line:36,column:3}},type:'if',locations:[{start:{line:34,column:2},end:{line:36,column:3}},{start:{line:34,column:2},end:{line:36,column:3}}],line:34},'2':{loc:{start:{line:40,column:2},end:{line:42,column:3}},type:'if',locations:[{start:{line:40,column:2},end:{line:42,column:3}},{start:{line:40,column:2},end:{line:42,column:3}}],line:40},'3':{loc:{start:{line:40,column:6},end:{line:40,column:62}},type:'binary-expr',locations:[{start:{line:40,column:6},end:{line:40,column:39}},{start:{line:40,column:43},end:{line:40,column:62}}],line:40},'4':{loc:{start:{line:49,column:2},end:{line:51,column:3}},type:'if',locations:[{start:{line:49,column:2},end:{line:51,column:3}},{start:{line:49,column:2},end:{line:51,column:3}}],line:49},'5':{loc:{start:{line:54,column:2},end:{line:60,column:3}},type:'if',locations:[{start:{line:54,column:2},end:{line:60,column:3}},{start:{line:54,column:2},end:{line:60,column:3}}],line:54},'6':{loc:{start:{line:54,column:6},end:{line:54,column:44}},type:'binary-expr',locations:[{start:{line:54,column:6},end:{line:54,column:25}},{start:{line:54,column:29},end:{line:54,column:44}}],line:54},'7':{loc:{start:{line:63,column:2},end:{line:66,column:3}},type:'if',locations:[{start:{line:63,column:2},end:{line:66,column:3}},{start:{line:63,column:2},end:{line:66,column:3}}],line:63},'8':{loc:{start:{line:75,column:2},end:{line:76,column:37}},type:'if',locations:[{start:{line:75,column:2},end:{line:76,column:37}},{start:{line:75,column:2},end:{line:76,column:37}}],line:75},'9':{loc:{start:{line:78,column:2},end:{line:81,column:3}},type:'if',locations:[{start:{line:78,column:2},end:{line:81,column:3}},{start:{line:78,column:2},end:{line:81,column:3}}],line:78},'10':{loc:{start:{line:83,column:2},end:{line:94,column:3}},type:'if',locations:[{start:{line:83,column:2},end:{line:94,column:3}},{start:{line:83,column:2},end:{line:94,column:3}}],line:83},'11':{loc:{start:{line:106,column:4},end:{line:116,column:5}},type:'if',locations:[{start:{line:106,column:4},end:{line:116,column:5}},{start:{line:106,column:4},end:{line:116,column:5}}],line:106},'12':{loc:{start:{line:121,column:4},end:{line:123,column:5}},type:'if',locations:[{start:{line:121,column:4},end:{line:123,column:5}},{start:{line:121,column:4},end:{line:123,column:5}}],line:121},'13':{loc:{start:{line:128,column:4},end:{line:130,column:5}},type:'if',locations:[{start:{line:128,column:4},end:{line:130,column:5}},{start:{line:128,column:4},end:{line:130,column:5}}],line:128},'14':{loc:{start:{line:132,column:4},end:{line:178,column:5}},type:'if',locations:[{start:{line:132,column:4},end:{line:178,column:5}},{start:{line:132,column:4},end:{line:178,column:5}}],line:132},'15':{loc:{start:{line:134,column:11},end:{line:178,column:5}},type:'if',locations:[{start:{line:134,column:11},end:{line:178,column:5}},{start:{line:134,column:11},end:{line:178,column:5}}],line:134},'16':{loc:{start:{line:142,column:11},end:{line:178,column:5}},type:'if',locations:[{start:{line:142,column:11},end:{line:178,column:5}},{start:{line:142,column:11},end:{line:178,column:5}}],line:142},'17':{loc:{start:{line:150,column:8},end:{line:150,column:78}},type:'if',locations:[{start:{line:150,column:8},end:{line:150,column:78}},{start:{line:150,column:8},end:{line:150,column:78}}],line:150},'18':{loc:{start:{line:152,column:8},end:{line:160,column:9}},type:'if',locations:[{start:{line:152,column:8},end:{line:160,column:9}},{start:{line:152,column:8},end:{line:160,column:9}}],line:152},'19':{loc:{start:{line:165,column:21},end:{line:165,column:66}},type:'cond-expr',locations:[{start:{line:165,column:50},end:{line:165,column:57}},{start:{line:165,column:60},end:{line:165,column:66}}],line:165},'20':{loc:{start:{line:169,column:6},end:{line:177,column:7}},type:'if',locations:[{start:{line:169,column:6},end:{line:177,column:7}},{start:{line:169,column:6},end:{line:177,column:7}}],line:169},'21':{loc:{start:{line:184,column:4},end:{line:186,column:5}},type:'if',locations:[{start:{line:184,column:4},end:{line:186,column:5}},{start:{line:184,column:4},end:{line:186,column:5}}],line:184},'22':{loc:{start:{line:204,column:4},end:{line:206,column:5}},type:'if',locations:[{start:{line:204,column:4},end:{line:206,column:5}},{start:{line:204,column:4},end:{line:206,column:5}}],line:204},'23':{loc:{start:{line:213,column:4},end:{line:216,column:5}},type:'if',locations:[{start:{line:213,column:4},end:{line:216,column:5}},{start:{line:213,column:4},end:{line:216,column:5}}],line:213},'24':{loc:{start:{line:224,column:4},end:{line:232,column:5}},type:'if',locations:[{start:{line:224,column:4},end:{line:232,column:5}},{start:{line:224,column:4},end:{line:232,column:5}}],line:224},'25':{loc:{start:{line:229,column:6},end:{line:231,column:7}},type:'if',locations:[{start:{line:229,column:6},end:{line:231,column:7}},{start:{line:229,column:6},end:{line:231,column:7}}],line:229},'26':{loc:{start:{line:238,column:2},end:{line:245,column:3}},type:'if',locations:[{start:{line:238,column:2},end:{line:245,column:3}},{start:{line:238,column:2},end:{line:245,column:3}}],line:238}},s:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0,'14':0,'15':0,'16':0,'17':0,'18':0,'19':0,'20':0,'21':0,'22':0,'23':0,'24':0,'25':0,'26':0,'27':0,'28':0,'29':0,'30':0,'31':0,'32':0,'33':0,'34':0,'35':0,'36':0,'37':0,'38':0,'39':0,'40':0,'41':0,'42':0,'43':0,'44':0,'45':0,'46':0,'47':0,'48':0,'49':0,'50':0,'51':0,'52':0,'53':0,'54':0,'55':0,'56':0,'57':0,'58':0,'59':0,'60':0,'61':0,'62':0,'63':0,'64':0,'65':0,'66':0,'67':0,'68':0,'69':0,'70':0,'71':0,'72':0,'73':0,'74':0,'75':0,'76':0,'77':0,'78':0,'79':0,'80':0,'81':0,'82':0,'83':0,'84':0,'85':0,'86':0,'87':0,'88':0,'89':0,'90':0,'91':0,'92':0,'93':0,'94':0,'95':0,'96':0,'97':0,'98':0,'99':0,'100':0,'101':0,'102':0,'103':0,'104':0,'105':0,'106':0,'107':0,'108':0,'109':0,'110':0,'111':0,'112':0},f:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0},b:{'0':[0,0],'1':[0,0],'2':[0,0],'3':[0,0],'4':[0,0],'5':[0,0],'6':[0,0],'7':[0,0],'8':[0,0],'9':[0,0],'10':[0,0],'11':[0,0],'12':[0,0],'13':[0,0],'14':[0,0],'15':[0,0],'16':[0,0],'17':[0,0],'18':[0,0],'19':[0,0],'20':[0,0],'21':[0,0],'22':[0,0],'23':[0,0],'24':[0,0],'25':[0,0],'26':[0,0]},_coverageSchema:'332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();const Interface=(cov_iomb9fg5i.s[0]++,require('readline').Interface);const REPL=(cov_iomb9fg5i.s[1]++,require('repl'));const path=(cov_iomb9fg5i.s[2]++,require('path'));const fs=(cov_iomb9fg5i.s[3]++,require('fs'));const os=(cov_iomb9fg5i.s[4]++,require('os'));const util=(cov_iomb9fg5i.s[5]++,require('util'));const debug=(cov_iomb9fg5i.s[6]++,util.debuglog('repl'));cov_iomb9fg5i.s[7]++;module.exports=Object.create(REPL);cov_iomb9fg5i.s[8]++;module.exports.createInternalRepl=createRepl;// XXX(chrisdickinson): The 15ms debounce value is somewhat arbitrary.
// The debounce is to guard against code pasted into the REPL.
const kDebounceHistoryMS=(cov_iomb9fg5i.s[9]++,15);function _writeToOutput(repl,message){cov_iomb9fg5i.f[0]++;cov_iomb9fg5i.s[10]++;repl._writeToOutput(message);cov_iomb9fg5i.s[11]++;repl._refreshLine();}function createRepl(env,opts,cb){cov_iomb9fg5i.f[1]++;cov_iomb9fg5i.s[12]++;if(typeof opts==='function'){cov_iomb9fg5i.b[0][0]++;cov_iomb9fg5i.s[13]++;cb=opts;cov_iomb9fg5i.s[14]++;opts=null;}else{cov_iomb9fg5i.b[0][1]++;}cov_iomb9fg5i.s[15]++;opts=util._extend({ignoreUndefined:false,terminal:process.stdout.isTTY,useGlobal:true,breakEvalOnSigint:true},opts);cov_iomb9fg5i.s[16]++;if(parseInt(env.NODE_NO_READLINE)){cov_iomb9fg5i.b[1][0]++;cov_iomb9fg5i.s[17]++;opts.terminal=false;}else{cov_iomb9fg5i.b[1][1]++;}// the "dumb" special terminal, as defined by terminfo, doesn't support
// ANSI colour control codes.
// see http://invisible-island.net/ncurses/terminfo.ti.html#toc-_Specials
cov_iomb9fg5i.s[18]++;if((cov_iomb9fg5i.b[3][0]++,parseInt(env.NODE_DISABLE_COLORS))||(cov_iomb9fg5i.b[3][1]++,env.TERM==='dumb')){cov_iomb9fg5i.b[2][0]++;cov_iomb9fg5i.s[19]++;opts.useColors=false;}else{cov_iomb9fg5i.b[2][1]++;}cov_iomb9fg5i.s[20]++;opts.replMode={'strict':REPL.REPL_MODE_STRICT,'sloppy':REPL.REPL_MODE_SLOPPY}[String(env.NODE_REPL_MODE).toLowerCase().trim()];cov_iomb9fg5i.s[21]++;if(opts.replMode===undefined){cov_iomb9fg5i.b[4][0]++;cov_iomb9fg5i.s[22]++;opts.replMode=REPL.REPL_MODE_SLOPPY;}else{cov_iomb9fg5i.b[4][1]++;}const historySize=(cov_iomb9fg5i.s[23]++,Number(env.NODE_REPL_HISTORY_SIZE));cov_iomb9fg5i.s[24]++;if((cov_iomb9fg5i.b[6][0]++,!isNaN(historySize))&&(cov_iomb9fg5i.b[6][1]++,historySize>0)){cov_iomb9fg5i.b[5][0]++;cov_iomb9fg5i.s[25]++;opts.historySize=historySize;}else{cov_iomb9fg5i.b[5][1]++;cov_iomb9fg5i.s[26]++;// XXX(chrisdickinson): set here to avoid affecting existing applications
// using repl instances.
opts.historySize=1000;}const repl=(cov_iomb9fg5i.s[27]++,REPL.start(opts));cov_iomb9fg5i.s[28]++;if(opts.terminal){cov_iomb9fg5i.b[7][0]++;cov_iomb9fg5i.s[29]++;return setupHistory(repl,env.NODE_REPL_HISTORY,env.NODE_REPL_HISTORY_FILE,cb);}else{cov_iomb9fg5i.b[7][1]++;}cov_iomb9fg5i.s[30]++;repl._historyPrev=_replHistoryMessage;cov_iomb9fg5i.s[31]++;cb(null,repl);}function setupHistory(repl,historyPath,oldHistoryPath,ready){cov_iomb9fg5i.f[2]++;cov_iomb9fg5i.s[32]++;// Empty string disables persistent history.
if(typeof historyPath==='string'){cov_iomb9fg5i.b[8][0]++;cov_iomb9fg5i.s[33]++;historyPath=historyPath.trim();}else{cov_iomb9fg5i.b[8][1]++;}cov_iomb9fg5i.s[34]++;if(historyPath===''){cov_iomb9fg5i.b[9][0]++;cov_iomb9fg5i.s[35]++;repl._historyPrev=_replHistoryMessage;cov_iomb9fg5i.s[36]++;return ready(null,repl);}else{cov_iomb9fg5i.b[9][1]++;}cov_iomb9fg5i.s[37]++;if(!historyPath){cov_iomb9fg5i.b[10][0]++;cov_iomb9fg5i.s[38]++;try{cov_iomb9fg5i.s[39]++;historyPath=path.join(os.homedir(),'.node_repl_history');}catch(err){cov_iomb9fg5i.s[40]++;_writeToOutput(repl,'\nError: Could not get the home directory.\n'+'REPL session history will not be persisted.\n');cov_iomb9fg5i.s[41]++;debug(err.stack);cov_iomb9fg5i.s[42]++;repl._historyPrev=_replHistoryMessage;cov_iomb9fg5i.s[43]++;return ready(null,repl);}}else{cov_iomb9fg5i.b[10][1]++;}var timer=(cov_iomb9fg5i.s[44]++,null);var writing=(cov_iomb9fg5i.s[45]++,false);var pending=(cov_iomb9fg5i.s[46]++,false);cov_iomb9fg5i.s[47]++;repl.pause();// History files are conventionally not readable by others:
// https://github.com/nodejs/node/issues/3392
// https://github.com/nodejs/node/pull/3394
cov_iomb9fg5i.s[48]++;fs.open(historyPath,'a+',0o0600,oninit);function oninit(err,hnd){cov_iomb9fg5i.f[3]++;cov_iomb9fg5i.s[49]++;if(err){cov_iomb9fg5i.b[11][0]++;cov_iomb9fg5i.s[50]++;// Cannot open history file.
// Don't crash, just don't persist history.
_writeToOutput(repl,'\nError: Could not open history file.\n'+'REPL session history will not be persisted.\n');cov_iomb9fg5i.s[51]++;debug(err.stack);cov_iomb9fg5i.s[52]++;repl._historyPrev=_replHistoryMessage;cov_iomb9fg5i.s[53]++;repl.resume();cov_iomb9fg5i.s[54]++;return ready(null,repl);}else{cov_iomb9fg5i.b[11][1]++;}cov_iomb9fg5i.s[55]++;fs.close(hnd,onclose);}function onclose(err){cov_iomb9fg5i.f[4]++;cov_iomb9fg5i.s[56]++;if(err){cov_iomb9fg5i.b[12][0]++;cov_iomb9fg5i.s[57]++;return ready(err);}else{cov_iomb9fg5i.b[12][1]++;}cov_iomb9fg5i.s[58]++;fs.readFile(historyPath,'utf8',onread);}function onread(err,data){cov_iomb9fg5i.f[5]++;cov_iomb9fg5i.s[59]++;if(err){cov_iomb9fg5i.b[13][0]++;cov_iomb9fg5i.s[60]++;return ready(err);}else{cov_iomb9fg5i.b[13][1]++;}cov_iomb9fg5i.s[61]++;if(data){cov_iomb9fg5i.b[14][0]++;cov_iomb9fg5i.s[62]++;repl.history=data.split(/[\n\r]+/,repl.historySize);}else{cov_iomb9fg5i.b[14][1]++;cov_iomb9fg5i.s[63]++;if(oldHistoryPath===historyPath){cov_iomb9fg5i.b[15][0]++;cov_iomb9fg5i.s[64]++;// If pre-v3.0, the user had set NODE_REPL_HISTORY_FILE to
// ~/.node_repl_history, warn the user about it and proceed.
_writeToOutput(repl,'\nThe old repl history file has the same name and location as '+`the new one i.e., ${historyPath} and is empty.\nUsing it as is.\n`);}else{cov_iomb9fg5i.b[15][1]++;cov_iomb9fg5i.s[65]++;if(oldHistoryPath){cov_iomb9fg5i.b[16][0]++;let threw=(cov_iomb9fg5i.s[66]++,false);cov_iomb9fg5i.s[67]++;try{// Pre-v3.0, repl history was stored as JSON.
// Try and convert it to line separated history.
const oldReplJSONHistory=(cov_iomb9fg5i.s[68]++,fs.readFileSync(oldHistoryPath,'utf8'));// Only attempt to use the history if there was any.
cov_iomb9fg5i.s[69]++;if(oldReplJSONHistory){cov_iomb9fg5i.b[17][0]++;cov_iomb9fg5i.s[70]++;repl.history=JSON.parse(oldReplJSONHistory);}else{cov_iomb9fg5i.b[17][1]++;}cov_iomb9fg5i.s[71]++;if(Array.isArray(repl.history)){cov_iomb9fg5i.b[18][0]++;cov_iomb9fg5i.s[72]++;repl.history=repl.history.slice(0,repl.historySize);}else{cov_iomb9fg5i.b[18][1]++;cov_iomb9fg5i.s[73]++;threw=true;cov_iomb9fg5i.s[74]++;_writeToOutput(repl,'\nError: The old history file data has to be an Array.\n'+'REPL session history will not be persisted.\n');}}catch(err){cov_iomb9fg5i.s[75]++;// Cannot open or parse history file.
// Don't crash, just don't persist history.
threw=true;const type=(cov_iomb9fg5i.s[76]++,err instanceof SyntaxError?(cov_iomb9fg5i.b[19][0]++,'parse'):(cov_iomb9fg5i.b[19][1]++,'open'));cov_iomb9fg5i.s[77]++;_writeToOutput(repl,`\nError: Could not ${type} old history file.\n`+'REPL session history will not be persisted.\n');}cov_iomb9fg5i.s[78]++;if(!threw){cov_iomb9fg5i.b[20][0]++;cov_iomb9fg5i.s[79]++;// Grab data from the older pre-v3.0 JSON NODE_REPL_HISTORY_FILE format.
_writeToOutput(repl,'\nConverted old JSON repl history to line-separated history.\n'+`The new repl history file can be found at ${historyPath}.\n`);}else{cov_iomb9fg5i.b[20][1]++;cov_iomb9fg5i.s[80]++;repl.history=[];}}else{cov_iomb9fg5i.b[16][1]++;}}}cov_iomb9fg5i.s[81]++;fs.open(historyPath,'r+',onhandle);}function onhandle(err,hnd){cov_iomb9fg5i.f[6]++;cov_iomb9fg5i.s[82]++;if(err){cov_iomb9fg5i.b[21][0]++;cov_iomb9fg5i.s[83]++;return ready(err);}else{cov_iomb9fg5i.b[21][1]++;}cov_iomb9fg5i.s[84]++;fs.ftruncate(hnd,0,err=>{cov_iomb9fg5i.f[7]++;cov_iomb9fg5i.s[85]++;repl._historyHandle=hnd;cov_iomb9fg5i.s[86]++;repl.on('line',online);// reading the file data out erases it
cov_iomb9fg5i.s[87]++;repl.once('flushHistory',function(){cov_iomb9fg5i.f[8]++;cov_iomb9fg5i.s[88]++;repl.resume();cov_iomb9fg5i.s[89]++;ready(null,repl);});cov_iomb9fg5i.s[90]++;flushHistory();});}// ------ history listeners ------
function online(){cov_iomb9fg5i.f[9]++;cov_iomb9fg5i.s[91]++;repl._flushing=true;cov_iomb9fg5i.s[92]++;if(timer){cov_iomb9fg5i.b[22][0]++;cov_iomb9fg5i.s[93]++;clearTimeout(timer);}else{cov_iomb9fg5i.b[22][1]++;}cov_iomb9fg5i.s[94]++;timer=setTimeout(flushHistory,kDebounceHistoryMS);}function flushHistory(){cov_iomb9fg5i.f[10]++;cov_iomb9fg5i.s[95]++;timer=null;cov_iomb9fg5i.s[96]++;if(writing){cov_iomb9fg5i.b[23][0]++;cov_iomb9fg5i.s[97]++;pending=true;cov_iomb9fg5i.s[98]++;return;}else{cov_iomb9fg5i.b[23][1]++;}cov_iomb9fg5i.s[99]++;writing=true;const historyData=(cov_iomb9fg5i.s[100]++,repl.history.join(os.EOL));cov_iomb9fg5i.s[101]++;fs.write(repl._historyHandle,historyData,0,'utf8',onwritten);}function onwritten(err,data){cov_iomb9fg5i.f[11]++;cov_iomb9fg5i.s[102]++;writing=false;cov_iomb9fg5i.s[103]++;if(pending){cov_iomb9fg5i.b[24][0]++;cov_iomb9fg5i.s[104]++;pending=false;cov_iomb9fg5i.s[105]++;online();}else{cov_iomb9fg5i.b[24][1]++;cov_iomb9fg5i.s[106]++;repl._flushing=Boolean(timer);cov_iomb9fg5i.s[107]++;if(!repl._flushing){cov_iomb9fg5i.b[25][0]++;cov_iomb9fg5i.s[108]++;repl.emit('flushHistory');}else{cov_iomb9fg5i.b[25][1]++;}}}}function _replHistoryMessage(){cov_iomb9fg5i.f[12]++;cov_iomb9fg5i.s[109]++;if(this.history.length===0){cov_iomb9fg5i.b[26][0]++;cov_iomb9fg5i.s[110]++;_writeToOutput(this,'\nPersistent history support disabled. '+'Set the NODE_REPL_HISTORY environment\nvariable to '+'a valid, user-writable path to enable.\n');}else{cov_iomb9fg5i.b[26][1]++;}cov_iomb9fg5i.s[111]++;this._historyPrev=Interface.prototype._historyPrev;cov_iomb9fg5i.s[112]++;return this._historyPrev();}